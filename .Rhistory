devtools::install_github("r-lib/pkgdown")
setwd("~/Documents/spsurv")
usethis::use_pkgdown()
pkgdown::build_site()
devtools::load_all()
### ------------------------------------------------
# b_{0,4}(x) &= (1-x)^{4},\\
# b_{1,4}(x) &= 4 x(1-x)^{3},   & \quad
# b_{2,4}(x) &= 6 x^2(1-x)^{2}, \\
# b_{3,4}(x) &= 4 x^3(1-x) & \quad
# b_{4,4}(x) &= x^4.
par(bg=NA)
m <- 4; tau <- 1; k <- 0
curve(choose(m, k)*((x/tau)^k)*(1-(x/tau))^(m-k), xlim = c(0, tau), ylim = c(0,1), frame = F, lwd = 15, col = viridis(m+1)[1], ylab = "", xlab = "", cex.axis  = 1.5)
axis(side = 2, at = c(0.2,0.6,1), cex.axis = 1.5)
### ------------------------------------------------
# b_{0,4}(x) &= (1-x)^{4},\\
# b_{1,4}(x) &= 4 x(1-x)^{3},   & \quad
# b_{2,4}(x) &= 6 x^2(1-x)^{2}, \\
# b_{3,4}(x) &= 4 x^3(1-x) & \quad
# b_{4,4}(x) &= x^4.
library("viridis")
par(bg=NA)
m <- 4; tau <- 1; k <- 0
curve(choose(m, k)*((x/tau)^k)*(1-(x/tau))^(m-k), xlim = c(0, tau), ylim = c(0,1), frame = F, lwd = 15, col = viridis(m+1)[1], ylab = "", xlab = "", cex.axis  = 1.5)
axis(side = 2, at = c(0.2,0.6,1), cex.axis = 1.5)
for(k in 1:m){
curve(choose(m, k)*((x/tau)^k)*(1-(x/tau))^(m-k), add = T, col = viridis(m+1)[k+1], lwd = 15)
}
library("hexSticker")
sticker("inst/figures/bp.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png", p_family = "ASC")
sticker("inst/figures/bp.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/bp.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#DCDCDC", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#FDE725FF",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#ffff00",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#ffd700",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#ffd700",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#d4af37",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#c2e37b",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,  h_fill="#1E90FF", h_color="#cbfb63",
filename="inst/figures/imgfile.png")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png")
font_add_google("Gochi Hand", "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
library(showtext)
font_add_google("Gochi Hand", "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
font_add_google("Russo One", "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#1E90FF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#BAEDFF", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#0784BA", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#3EB9A5", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#3EB9A5", h_color="#E9A02F",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#01ACB6", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#01ACB6", h_color="#2B2B2D",
filename="inst/figures/imgfile.png", p_family = "f")
sticker("inst/figures/Rplot.png", package="spsurv", p_size=20, s_x=1, s_y=.75, s_width=.6,
h_fill="#01ACB6", h_color="#9be203",
filename="inst/figures/imgfile.png", p_family = "f")
devtools::release()
curve(1/x)
curve(1/x-2)
curve(1/(x-2))
curve(1/(x-2), ylim = c(0,10), xlim = c(0,10))
curve(1/(x-20), ylim = c(0,10), xlim = c(0,10))
curve(1/(x-20), ylim = c(0,10), xlim = c(0,20))
curve(1/(x-20), ylim = c(0,10), xlim = c(0,10))
curve(1/(x-20), ylim = c(0,10), xlim = c(0,100))
colMeans(iris[,-5])
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
pkgdown::build_site()
devtools::load_all()
spsurv::rsurv()
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- spsurv::survfit(fit, newdata = newdata)
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
## Determine the groups of patients
newdata <-  data.frame(age =c(77,77,77,77), stage = c(1,2,3,4))
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
source("~/Documents/spsurv/run_tests.r", echo = TRUE)
source("~/Documents/spsurv/run_tests.r", echo = TRUE)
devtools::install()
devtools::install()
devtools::install()
source("~/.active-rstudio-document", echo = TRUE)
remove.packages(spsurv)
remove.packages("spsurv")
devtools::install()
library("KMsurv")
data("larynx", package = "KMsurv")
print(larynx)
library("spsurv")
mod_bp <- spbp(
formula = Surv(time, delta) ~ age + factor(stage),
model = "ph", data = larynx, init = 0
)
getwd()
devtools::install()
library("KMsurv")
data("larynx", package = "KMsurv")
print(larynx)
library("spsurv")
mod_bp <- spbp(
formula = Surv(time, delta) ~ age + factor(stage),
model = "ph", data = larynx, init = 0
)
summary(mod_bp)
library("survminer")
newdata <- data.frame(age = 70, stage = unique(larynx$stage))
fit_bp_new <- survfit(mod_bp, newdata)
summary(fit_bp_new)
ggsurvplot(fit_bp_new, data = larynx, conf.int = F, surv.median.line = "hv")
mod_bp2 <- bpph(
formula = Surv(time, delta) ~ age + factor(stage),
approach = "bayes", data = larynx, init = "0"
)
summary(mod_bp2)
library("bayesplot")
mcmc_pairs(mod_bp2$posterior$beta, off_diag_fun = "hex")
library("survival")
mod <- coxph(Surv(time, delta) ~ age + factor(stage), data = larynx)
res_bp <- residuals(mod_bp)
res_bp2 <- residuals(mod_bp2)
plot(data.frame(res_bp, res_bp2, residuals(mod)), pch = 19)
library("survival")
data("cancer", package = "survival")
veteran2 <- veteran[veteran$prior == 0, ]
veteran2$celltype <- factor(
x = veteran2$celltype,
levels = c("large", "adeno", "smallcell", "squamous")
)
print(veteran2)
mod_bp3 <- bppo(
formula = Surv(time, status) ~ karno + factor(celltype),
approach = "bayes", data = veteran2
)
mod_bp4 <- bpaft(
formula = Surv(time, status) ~ karno + factor(celltype),
approach = "bayes", data = veteran2
)
newdata2 <- data.frame(karno = c(30, 70), celltype = "squamous")
fit_bp3 <- survfit(mod_bp3, newdata = newdata2)
fit_bp4 <- survfit(mod_bp4, newdata = newdata2)
library("survminer")
ggsurvplot(list(BPAFT = fit_bp4, BPPO = fit_bp3), combine = TRUE, conf.int = T)
library("ggplot2")
library("patchwork")
km_bp3 <- survfit(Surv(resid(mod_bp3, "cox-snell"), veteran2$status) ~ 1)
km_bp4 <- survfit(Surv(resid(mod_bp4, "cox-snell"), veteran2$status) ~ 1)
p1 <- ggplot() +
geom_step(aes(x = km_bp3$time, y = -log(km_bp3$surv))) +
scale_y_continuous(limits = c(0, 4)) +
labs(x = "Residuals BPPO", y = "Cumulative hazard") +
geom_abline(col = c("blue"))
p2 <- ggplot() +
geom_step(aes(x = km_bp4$time, y = -log(km_bp4$surv))) +
scale_y_continuous(limits = c(0, 4)) +
labs(x = "Residuals BPAFT", y = "Cumulative hazard") +
geom_abline(col = c("blue"))
p1 + p2
mod_bp3_null <- bppo(formula = Surv(time, status) ~ 1, approach = "mle", data = veteran2)
mod_bp4_null <- bpaft(formula = Surv(time, status) ~ 1, approach = "bayes", data = veteran2)
p3 <- ggplot() +
geom_point(aes(
x = veteran2$karno, residuals(mod_bp3_null),
color = factor(veteran2$status)
)) +
ylim(-4, 2) +
geom_smooth(aes(x = veteran2$karno, residuals(mod_bp3_null)),
method = "loess"
) +
labs(y = "Martingale residuals BPPO", x = "PS")
p4 <- ggplot() +
geom_point(aes(
x = veteran2$karno, residuals(mod_bp4_null),
color = factor(veteran2$status)
)) +
ylim(-4, 2) +
geom_smooth(aes(x = veteran2$karno, residuals(mod_bp4_null)),
method = "loess"
) +
ylab("Martingale residuals BPAFT") +
xlab("PS")
p3 + p4
p5 <- ggplot() +
geom_point(aes(
x = veteran2$karno, resid(mod_bp3, type = "deviance"),
color = factor(veteran2$status)
)) +
labs(y = "Deviance residuals BPPO", x = "PS") +
theme_survminer()
p6 <- ggplot() +
geom_point(aes(
x = veteran2$karno, resid(mod_bp4, type = "deviance"),
color = factor(veteran2$status)
)) +
labs(y = "Deviance residuals BPAFT", x = "PS") +
theme_survminer()
p5 + p6
setwd("~/Documents/spsurv")
devtools::load_all()
devtools::document()
# devtools::install()
devtools::install(quick=TRUE)
usethis::use_build_ignore("_pkgdown.yml")
usethis::use_build_ignore("codecov.yml")
usethis::use_build_ignore(".travis.yml")
usethis::use_build_ignore("_config.yml")
usethis::use_build_ignore("cran-comments.md")
usethis::use_build_ignore("inst/dev.R")
usethis::use_build_ignore("inst/load.R")
#devtools::build_vignettes()
devtools::check()
library("KMsurv")
data("larynx")
library(spsurv)
fit <- spsurv::spbp(Surv(time, delta) ~ age + factor(stage),
approach = "mle", data = larynx
)
summary(fit)
library("KMsurv")
data("larynx")
library(spsurv)
fit <- spsurv::spbp(Surv(time, delta) ~ age + factor(stage),
approach = "mle", data = larynx
)
fit$coefficients
head(model.matrix(fit))
vcov(fit)
fit$loglik
options(mc.cores = 2)
fit <- spsurv::spbp(Surv(time, delta) ~ age + factor(stage),
approach = "bayes", data = larynx,
iter = 2000, chains = 1, warmup = 1000, cores = 1
)
summary(fit)
rstan::traceplot(fit$fit, pars = c("beta", "gamma"))
rstan::traceplot(fit$stanfit, pars = c("beta", "gamma"))
rstan::stan_dens(fit$stanfit, pars = c("beta", "gamma"))
## CoxPH model
fitcoxph <- survival::coxph(Surv(time, delta) ~ age + factor(stage),
data = larynx
)
## Determine the groups of patients
newdata <- data.frame(age = c(77, 77, 77, 77), stage = c(1, 2, 3, 4))
## survfit Breslow estimator
breslowsurv <- survival::survfit(fitcoxph, newdata = newdata)
## spbp point-wise estimate
spbpsurv <- survfit(fit, newdata = newdata)
plot(breslowsurv, bty = "n", lwd = 3, main = "77 years old patient survival per Stage")
plot(spbpsurv, bty = "n", lwd = 3, main = "77 years old patient survival per Stage")
mod_bp <- spbp(
formula = Surv(time, delta) ~ age + factor(stage),
model = "ph", data = larynx, init = 0
)
summary(mod_bp)
library("survminer")
newdata <- data.frame(age = 70, stage = unique(larynx$stage))
fit_bp_new <- survfit(mod_bp, newdata)
summary(fit_bp_new)
ggsurvplot(fit_bp_new, data = larynx, conf.int = F, surv.median.line = "hv")
mod_bp <- spbp(
formula = Surv(time, delta) ~ age + factor(stage),
model = "ph", data = larynx, init = 0
)
summary(mod_bp)
library("survminer")
newdata <- data.frame(age = 70, stage = unique(larynx$stage))
fit_bp_new <- survfit(mod_bp, newdata)
summary(fit_bp_new)
ggsurvplot(fit_bp_new, data = larynx, conf.int = F, surv.median.line = "hv")
plot(mod_bp)
mod_bp2 <- bpph(
formula = Surv(time, delta) ~ age + factor(stage),
approach = "bayes", data = larynx, init = "0"
)
source("~/Documents/spsurv/inst/dev.R", echo = TRUE)
source("~/Documents/spsurv/inst/dev.R", echo = TRUE)
setwd("~/Documents/spsurv")
devtools::load_all()
devtools::document()
# devtools::install()
devtools::install(quick=TRUE)
usethis::use_build_ignore("_pkgdown.yml")
usethis::use_build_ignore("codecov.yml")
usethis::use_build_ignore(".travis.yml")
usethis::use_build_ignore("_config.yml")
usethis::use_build_ignore("cran-comments.md")
usethis::use_build_ignore("inst/dev.R")
usethis::use_build_ignore("inst/load.R")
#devtools::build_vignettes()
devtools::check()
source("~/Documents/spsurv/inst/dev.R", echo = TRUE)
#devtools::build_vignettes()
devtools::check()
roxygen2::roxygenise()
#devtools::build_vignettes()
devtools::check()
#devtools::build_vignettes()
devtools::check()
#devtools::build_vignettes()
devtools::check()
library(spsurv)
data("cancer")
## PH model
ph_fit <- bpph(Surv(time, status)~karno+factor(celltype),  data = veteran)## PO model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
residuals(ph_fit)
print(summary(ph_fit))
expect_warning(traceplot(ph_fit))
print(summary(ph_fit))
expect_warning(traceplot(ph_fit))
expect_error(traceplot(ph_fit))
expect_warning(extract(ph_fit))
traceplot(ph_fit)
## PH model
ph_fit <- bpph(Surv(time, status)~karno+factor(celltype),  data = veteran)## PO model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
residuals(ph_fit)
## PH model
ph_fit <- bpph(Surv(time, status)~karno+factor(celltype),  data = veteran)## PO model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
residuals(ph_fit)
print(summary(ph_fit))
ph_fit <- bpph(Surv(time, status)~karno+factor(celltype), approach = "bayes",  data = veteran,
iter = 10, chains = 1, cores = 1)## PH model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
print(summary(ph_fit))
expect_warning(confint(ph_fit))
summary(ph_fit)
print(summary(ph_fit))
expect_warning(confint(ph_fit))
ph_fit
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
styler:::style_active_pkg()
library(spsurv)
data("cancer")
## PH model
ph_fit <- bpph(Surv(time, status) ~ karno + factor(celltype), data = veteran) ## PO model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
residuals(ph_fit)
print(summary(ph_fit))
ph_fit <- bpph(Surv(time, status) ~ karno + factor(celltype),
approach = "bayes", data = veteran,
iter = 10, chains = 1, cores = 1
) ## PH model
print(ph_fit)
survfit(ph_fit)
summary(ph_fit)
print(summary(ph_fit))
expect_warning(confint(ph_fit))
expect_warning(coef(ph_fit))
confint(ph_fit)
confint(ph_fit)
confint(ph_fit)
#devtools::build_vignettes()
devtools::check()
source("~/Documents/spsurv/tests/testthat/test.R", echo = TRUE)
coef(ph_fit)
vcov(ph_fit)
source("~/Documents/spsurv/tests/testthat/test.R", echo = TRUE)
source("~/Documents/spsurv/tests/testthat/test.R", echo = TRUE)
source("~/Documents/spsurv/tests/testthat/test.R", echo = TRUE)
source("~/Documents/spsurv/inst/dev.R", echo = TRUE)
devtools::missing_s3()
devtools::check()
devtools::document()
devtools::document()
devtools::check()
devtools::check_man()
devtools::missing_s3()
usethis::use_build_ignore("_pkgdown.yml")
usethis::use_build_ignore("codecov.yml")
usethis::use_build_ignore(".travis.yml")
usethis::use_build_ignore("_config.yml")
usethis::use_build_ignore("cran-comments.md")
usethis::use_build_ignore("inst/dev.R")
usethis::use_build_ignore("inst/load.R")
#devtools::build_vignettes()
devtools::check()
devtools::check_man()
