<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>spsurv • spsurv</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="spsurv">
<meta property="og:description" content="spsurv">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spsurv</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/spsurv.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rvpanaro/spsurv/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>spsurv</h1>
            <h3 class="subtitle">An R package for semi-parametric survival analyis</h3>
                        <h4 class="author">R.V. Panaro</h4>
            <address class="author_afil">
      Universidade de São Paulo - USP<br><a class="author_email" href="mailto:#"></a><a href="mailto:renatovp@ime.usp.br" class="email">renatovp@ime.usp.br</a>
      </address>
                  
            <h4 class="date">2020-04-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rvpanaro/spsurv/blob/master/vignettes/spsurv.Rmd"><code>vignettes/spsurv.Rmd</code></a></small>
      <div class="hidden name"><code>spsurv.Rmd</code></div>

    </div>

    
    
<style>
body {
text-align: justify
</style>
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette gives the instructions on how to fit the Bernstein polynomial (BP) based survival regression models using the unprecedent routines implemented in the <code>spsurv</code> package. In addition to this vignette, you can have access to a full description of the methodology (MSc dissertation) available at arXiv, check it out <a href="https://arxiv.org/abs/2003.10548">https://arxiv.org/abs/2003.10548</a>. The <code><a href="../reference/spbp.html">spsurv::spbp</a></code> function is the main routine of this package, as it allows to fit all BP related survival regression approaches presented in the <a href="https://arxiv.org/abs/2003.10548">dissertation</a>. The acronym <code>spbp</code> refers to <em>semi-parametric Bernstein polynomial based regression</em>. The <code>formula</code> argument in <code><a href="../reference/spbp.html">spsurv::spbp</a></code> makes use of the same structure available at the <code>survival</code> package in order to provide a familiar environment to the public. The development version can be found on <a href="https://github.com/rvpanaro/spsurv">github.com/rvpanaro/spsurv</a>, it can be installed using:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"devtools"</span>)
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"rvpanaro/spsurv"</span>)</pre></body></html></div>
<p>The <code>spsurv</code> package imports specific routines that provide the necessary support for internal calculations. During the installation, other dependencies are required, such as <code>survival</code>, <code>loo</code>, <code>coda</code>, <code>rstan</code> and <code>MASS</code> packages.</p>
<p>The target data set is passed to the <code><a href="../reference/spbp.html">spsurv::spbp</a></code> function through a mandatory <code>data.frame</code> object class. Also, it is possible to switch between <code>bayesian</code> and <code>mle</code> approaches through the <code>approach</code> argument and between the <code>ph</code>, <code>po</code> and <code>aft</code> frameworks using the <code>model</code> argument. Naturally, prior choices are ignored if the <code>approach</code> argument is set to <code>mle</code> referring to maximum likelihood (ML) estimation; a warning is displayed in this case. In addition, consider extra arguments that may be passed directly to <code>Stan</code> software to apply <code><a href="https://rdrr.io/pkg/rstan/man/stanmodel-method-optimizing.html">rstan::optimizing</a></code> (if ML method), or <code><a href="https://rdrr.io/pkg/rstan/man/stanmodel-method-sampling.html">rstan::sampling</a></code> if Markov chain Monte Carlo (MCMC) method, function control options. Both methods were applied under the <code>rstan</code> interface, see <a href="https://mc-stan.org/users/interfaces/rstan">https://mc-stan.org/users/interfaces/rstan</a>.</p>
<div id="default-arguments" class="section level2">
<h2 class="hasAnchor">
<a href="#default-arguments" class="anchor"></a>Default arguments</h2>
<p>As mentioned in <a href="https://arxiv.org/abs/2003.10548">Chapter 4</a>, the polynomial degree (highest basis order) can be chosen arbitrarily. In particular, the polynomial degree must be greater than zero, the default value of the polynomial degree <span class="math inline">\(m = \sqrt{n}\)</span> is rounded to the greatest integer. Note that, the domain restriction for the BP, referred to as <span class="math inline">\(\tau\)</span> <a href="https://arxiv.org/abs/2003.10548">here</a>, is defined internally, see the discussion in <a href="https://arxiv.org/abs/2003.10548">Chapter 5</a>. The reason for not allowing a user-defined <span class="math inline">\(\tau\)</span> is to avoid an improper definition that would cause computing problems.</p>
<p>Considering the variety of settings that <code>Stan</code> can provide and the modeling options above, we believe that the package is flexible regarding user-defined applications of the BP based models. Beyond that, a class, namely <code>spbp</code> was created to extend some S3 methods that meet the <code>R</code> community need for printing, summarizing, and plotting functions. Accordingly, we had developed S3 methods extensions to accomplish these tasks such as the <code><a href="../reference/print.spbp.html">spsurv::print.spbp</a></code>, <code><a href="../reference/summary.spbp.html">spsurv::summary.spbp</a></code>, <code><a href="../reference/model.matrix.spbp.html">spsurv::model.matrix.spbp</a></code> and other summary printing extensions such as <code>print.summary.bpph.bayes</code>.</p>
<p>Further, there are some coding instructions on how to fit the semi-parametric models: Bernstein based proportional hazards (BPPH), Bernstein based proportional odds (BPPO), and Bernstein based accelerated failure time (BPAFT) models for right-censored data, under the Bayesian or frequentist approach. In the Bayesian perspective, Normal prior distributions are attributed to the regression coefficients while Log-Normal, Gamma, or Inverse Gamma can be attributed to the BP parameters. The default arguments for the <code>spbp</code> functions were set as follows:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">spbp.default</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/spbp.html">spbp</a></span>(<span class="no">formula</span>, <span class="no">degree</span>, <span class="no">data</span>,
            <span class="kw">approach</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mle"</span>, <span class="st">"bayes"</span>),
            <span class="kw">model</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"ph"</span>, <span class="st">"po"</span>, <span class="st">"aft"</span>),
            <span class="kw">priors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">beta</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"normal(0,4)"</span>),
                         <span class="kw">gamma</span> <span class="kw">=</span> <span class="st">"lognormal(0,10)"</span>),
           <span class="kw">scale</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
           <span class="no">...</span>)</pre></body></html></div>
<p>Consider <code>formula</code> an object of class formula, with the <code>Surv</code> object (<code>survival</code> package) for right-censored time-to-event data on the left side of <span class="math inline">\(\sim\)</span> and the explanatory terms on the right; <code>degree</code> for the integer value of the BP degree, non-integer values are rounded to the greatest valid degree; <code>data</code> for a mandatory <code>data.frame</code> object with variables named in the formula; <code>approach</code> for either Bayesian or ML estimation methods, default is <code>bayes</code>; <code>model</code> proportional hazards (PH), proportional odds (PO) or accelerated failure time (AFT) for the modeling classes discussed in <a href="https://arxiv.org/abs/2003.10548">Chapter 2</a>, default is <code>ph</code>; <code>priors</code> list of prior settings, which is ignored when <code>mle</code>, and <code>scale</code> for a logical value that indicates whether to apply the standardization discussed in <a href="https://arxiv.org/abs/2003.10548">Chapter 5</a>. Recall that extra arguments can be passed to <code><a href="https://rdrr.io/pkg/rstan/man/stanmodel-method-sampling.html">rstan::sampling</a></code> (e.g. <code>iter</code>, <code>chains</code>, <code>init</code>), more details in <a href="https://mc-stan.org/users/documentation/">https://mc-stan.org/users/documentation/</a>.</p>
<p>Most statistical packages about survival regression returns an ANOVA table. In this sense, the object of class <code>spbp</code> follows the design provided in the <code>survival</code> package. The output corresponding to the ANOVA table can be obtained with:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"KMsurv"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"larynx"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spsurv</span>)
<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="kw pkg">spsurv</span><span class="kw ns">::</span><span class="fu"><a href="../reference/spbp.html">spbp</a></span>(<span class="fu">Surv</span>(<span class="no">time</span>, <span class="no">delta</span>)~ <span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">stage</span>),
                    <span class="kw">approach</span> <span class="kw">=</span> <span class="st">"mle"</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">larynx</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<pre><code>## Bernstein Polynomial based Proportional Hazards model
## Call:
## spbp.default(formula = Surv(time, delta) ~ age + factor(stage), 
##     data = larynx, approach = "mle", model = "ph")
## 
##   n= 90, number of events= 50 
## 
##                  coef exp(coef) se(coef)    z Pr(&gt;|z|)    
## age            0.0193    1.0195   0.0144 1.34    0.180    
## factor(stage)2 0.1720    1.1876   0.4626 0.37    0.710    
## factor(stage)3 0.6585    1.9318   0.3556 1.85    0.064 .  
## factor(stage)4 1.7991    6.0442   0.4288 4.20  2.7e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Likelihood ratio test= 19.6  on 4 df,   p=6e-04
## Wald test            = 22.6  on 4 df,   p=2e-04</code></pre>
</div>
<div id="coding" class="section level2">
<h2 class="hasAnchor">
<a href="#coding" class="anchor"></a>Coding</h2>
<p>One can reproduce this example by copying and pasting the indicated code in the <code>R</code> console. The output is as follows:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"KMsurv"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"larynx"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">spsurv</span>)
<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="kw pkg">spsurv</span><span class="kw ns">::</span><span class="fu"><a href="../reference/spbp.html">spbp</a></span>(<span class="fu">Surv</span>(<span class="no">time</span>, <span class="no">delta</span>)~<span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">stage</span>),
                     <span class="kw">approach</span> <span class="kw">=</span> <span class="st">"mle"</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">larynx</span>)</pre></body></html></div>
<p>Consider that <code>coef</code> refers to the ML point estimates; <code><a href="https://rdrr.io/r/base/Log.html">exp(coef)</a></code> is the point estimate for the hazard ratio; <code>se(coef)</code> represents the standard errors; <code>z</code> is the test statistic for the Wald test and <code>p</code> is the p-value of the Wald test. The estimated BP parameters, the value of the evaluated log-likelihood of the null (reference) model and the <code>stan</code> object can be obtained having access to the <code>spbp</code> class object elements. Moreover, apart from the <code>fit</code> object, it is also possible to obtain the matrix of covariates, the covariance matrix and the likelihood value. This can be done using the following code:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">fit</span>$<span class="no">coefficients</span></pre></body></html></div>
<pre><code>##            age factor(stage)2 factor(stage)3 factor(stage)4         gamma1 
##   1.926946e-02   1.719545e-01   6.584531e-01   1.799095e+00   1.687151e-02 
##         gamma2         gamma3         gamma4         gamma5         gamma6 
##   4.164110e-02   8.170170e-50   1.401060e-02   4.677284e-02   9.401934e-34 
##         gamma7         gamma8         gamma9        gamma10 
##   1.331014e-01   1.189283e-62  4.517613e-112  3.128413e-131</code></pre>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="no">fit</span>))</pre></body></html></div>
<pre><code>##   age factor(stage)2 factor(stage)3 factor(stage)4
## 1  77              0              0              0
## 2  53              0              0              0
## 3  45              0              0              0
## 4  57              0              0              0
## 5  58              0              0              0
## 6  51              0              0              0</code></pre>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="no">fit</span>$<span class="no">var</span>)</pre></body></html></div>
<pre><code>##            age factor(stage)2 factor(stage)3 factor(stage)4 
##   0.0002064355   0.2139848904   0.1264739037   0.1838831112</code></pre>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">fit</span>$<span class="no">loglik</span></pre></body></html></div>
<pre><code>## [1] -149.8360 -140.0512</code></pre>
<p>From the Bayesian point of view, the <code>spbp</code> class contains posterior summary statistics such as the mode, median, mean and standard deviation, along with 95% HPD interval based on the posterior density. Note that the arguments passed after <code>data</code> are considered <code>Stan</code> specific control parameters. For instance, the argument <code>chain</code> allows to choose the number of chains in the MCMC . Other settings such as <code>iter</code> and <code>warmup</code> are also flexible and might be set at convenience. The user can simply type in the <code>R</code> console the code<br><code>??rstan::sampling</code>" for help. The following <code>R</code> console outcome refers to the Bayesian estimation for the <code>larynx</code> data set:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">fit</span> <span class="kw">&lt;-</span> <span class="kw pkg">spsurv</span><span class="kw ns">::</span><span class="fu"><a href="../reference/spbp.html">spbp</a></span>(<span class="fu">Surv</span>(<span class="no">time</span>, <span class="no">delta</span>)~<span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">stage</span>),
                     <span class="kw">approach</span> <span class="kw">=</span> <span class="st">"bayes"</span>,  <span class="kw">data</span> <span class="kw">=</span> <span class="no">larynx</span>,
                     <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">2000</span>, <span class="kw">chains</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">warmup</span> <span class="kw">=</span> <span class="fl">1000</span>, <span class="kw">cores</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<pre><code>## 
## SAMPLING FOR MODEL 'spbp' NOW (CHAIN 1).
## Chain 1: 
## Chain 1: Gradient evaluation took 3.7e-05 seconds
## Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.37 seconds.
## Chain 1: Adjust your expectations accordingly!
## Chain 1: 
## Chain 1: 
## Chain 1: Iteration:    1 / 2000 [  0%]  (Warmup)
## Chain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)
## Chain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)
## Chain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)
## Chain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)
## Chain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)
## Chain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)
## Chain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)
## Chain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)
## Chain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)
## Chain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)
## Chain 1: Iteration: 2000 / 2000 [100%]  (Sampling)
## Chain 1: 
## Chain 1:  Elapsed Time: 2.38067 seconds (Warm-up)
## Chain 1:                2.36772 seconds (Sampling)
## Chain 1:                4.74839 seconds (Total)
## Chain 1:</code></pre>
<pre><code>## Warning: Relative effective sample sizes ('r_eff' argument) not specified.
## For models fit with MCMC, the reported PSIS effective sample sizes and 
## MCSE estimates will be over-optimistic.</code></pre>
<pre><code>## Warning: 
## 3 (3.3%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>As with the ML estimation, the summary method is extended to the <code><a href="../reference/spbp.html">spsurv::spbp</a></code> class when applying to a Bayesian fit. Along with the regression estimates, this output also contains descriptive statistics for the posterior hazard ratio denoted by <code>_exp</code> (in the console output) and the diagnosis statistics from the <code>loo</code> package. The effective sample size <code>n_eff</code> gives an estimate of the independent draws from the posterior distribution, and <code>Rhat</code> referred to as the potential scale reduction statistic, is one of the useful ways to monitor whether a chain has converged to the equilibrium distribution. This statistic measures the ratio between the average variation of the samples within each chain and the variation of the combined samples in the chains; if the chains have not converged to a common distribution, this statistic will be greater than one. It is worth noting that all, the information provided by the <code>Stan</code> output, including warnings, is passed to the final user. One can have access to the <code>stanfit</code> object with the <code>fit$stanfit</code> command. In particular, one can have access to built-in plot functions and even to a <code>shiny</code> app (details in <a href="https://shiny.rstudio.com/">https://shiny.rstudio.com/</a> developed by <code>Stan</code> developer’s team. The summary outcome is as follows:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">fit</span>)</pre></body></html></div>
<pre><code>## Bayesian Bernstein Polynomial based Proportional Hazards model
## 
## Call:
## spbp.default(formula = Surv(time, delta) ~ age + factor(stage), 
##     data = larynx, approach = "bayes", cores = 1, iter = 2000, 
##     chains = 1, warmup = 1000, model = "ph")
## 
##   n= 0, number of events= 0 
## 
##                  mode   mean se_mean     sd    50% n_eff  Rhat lowerHPD
## age            0.0201 0.0189 0.00046 0.0145 0.0191   993 0.999 -0.00911
## factor(stage)2 0.2448 0.1120 0.01740 0.4819 0.1467   767 1.001 -0.84032
## factor(stage)3 0.5840 0.6405 0.01272 0.3559 0.6398   783 0.999  0.02740
## factor(stage)4 1.6732 1.7712 0.01510 0.4219 1.7687   781 0.999  1.05130
##                upperHPD
## age              0.0467
## factor(stage)2   1.0030
## factor(stage)3   1.4031
## factor(stage)4   2.7070
## ---
##                mean_exp median_exp sd_exp lowerHPD_exp upperHPD_exp
## age                1.02       1.02 0.0148        0.991         1.05
## factor(stage)2     1.25       1.16 0.5946        0.293         2.43
## factor(stage)3     2.02       1.90 0.7320        0.769         3.38
## factor(stage)4     6.42       5.86 2.8349        2.009        12.26
## ---
## 
## Computed from 1000 by 90 log-likelihood matrix
## 
##           Estimate   SE
## elpd_waic   -149.9  9.5
## p_waic         9.6  1.0
## waic         299.8 19.0
## 
## 3 (3.3%) p_waic estimates greater than 0.4. We recommend trying loo instead. 
## 
## Computed from 1000 by 90 log-likelihood matrix
## 
##          Estimate   SE
## elpd_loo   -149.9  9.5
## p_loo         9.6  1.0
## looic       299.9 19.0
## ------
## Monte Carlo SE of elpd_loo is 0.1.
## 
## All Pareto k estimates are good (k &lt; 0.5).
## See help('pareto-k-diagnostic') for details.</code></pre>
</div>
<div id="graphical-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#graphical-analysis" class="anchor"></a>Graphical analysis</h2>
<p>The next code chunk shows the code for trace and density plotting and to give access to the shiny app from the shinystan package <code>shinystan</code>. Figures illustrate the trace plot and the density plot of the BPPH for the <code>larynx</code> data set. The graphs show unimodal posterior densities and well behaved chains with good mixing, this is a good behavior indication.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="kw pkg">rstan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstan/man/stanfit-method-traceplot.html">traceplot</a></span>(<span class="no">fit</span>$<span class="no">stanfit</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"beta"</span>, <span class="st">"gamma"</span>))</pre></body></html></div>
<p><img src="spsurv_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="kw pkg">rstan</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rstan/man/stan_plot.html">stan_dens</a></span>(<span class="no">fit</span>$<span class="no">stanfit</span>, <span class="kw">pars</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"beta"</span>, <span class="st">"gamma"</span>))</pre></body></html></div>
<p><img src="spsurv_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="kw pkg">shinystan</span><span class="kw ns">::</span><span class="fu">launch_shinystan</span>(<span class="no">fit</span>$<span class="no">stanfit</span>)</pre></body></html></div>
<p>Not least, a S3 method had to be created rather than extended. The <code>survivor</code> method was created to accomplish the calculation of the survival function evaluated in each time point. The goal is similar to the <code><a href="https://rdrr.io/pkg/survival/man/survfit.html">survival::survfit</a></code> S3 method, that could be extended instead. The difference is that <code>spbp</code> classes allows both Bayesian and frequentist approaches. The following code was used to generate Figure:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="co">## CoxPH model</span>
<span class="no">fitcoxph</span> <span class="kw">&lt;-</span> <span class="kw pkg">survival</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html">coxph</a></span>(<span class="fu">Surv</span>(<span class="no">time</span> , <span class="no">delta</span>)~<span class="no">age</span> + <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">stage</span>),
<span class="kw">data</span> <span class="kw">=</span> <span class="no">larynx</span>)

<span class="co">## Determine the groups of patients</span>
<span class="no">newdata</span> <span class="kw">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">age</span> <span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">77</span>,<span class="fl">77</span>,<span class="fl">77</span>,<span class="fl">77</span>), <span class="kw">stage</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>))

<span class="co">## survfit Breslow estimator</span>
<span class="no">breslowsurv</span> <span class="kw">&lt;-</span> <span class="kw pkg">survival</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/survfit.html">survfit</a></span>(<span class="no">fitcoxph</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newdata</span>)

<span class="co">## spbp point-wise estimate</span>
<span class="no">spbpsurv</span> <span class="kw">&lt;-</span> <span class="kw pkg">spsurv</span><span class="kw ns">::</span><span class="fu"><a href="../reference/survivor.html">survivor</a></span>(<span class="no">fit</span>, <span class="kw">newdata</span> <span class="kw">=</span> <span class="no">newdata</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">breslowsurv</span>, <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>, <span class="kw">lwd</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"77 years old patient survival per Stage"</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">spbpsurv</span>$<span class="no">time</span>, <span class="no">spbpsurv</span>$<span class="no">survival1</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">23</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">spbpsurv</span>$<span class="no">time</span>, <span class="no">spbpsurv</span>$<span class="no">survival2</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">23</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">spbpsurv</span>$<span class="no">time</span>, <span class="no">spbpsurv</span>$<span class="no">survival3</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">23</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">spbpsurv</span>$<span class="no">time</span>, <span class="no">spbpsurv</span>$<span class="no">survival4</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">4</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">23</span>)

<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Stage I"</span>, <span class="st">"Stage II"</span>, <span class="st">"Stage III"</span>, <span class="st">"Stage IV"</span>), <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">23</span>, <span class="kw">bty</span> <span class="kw">=</span> <span class="st">"n"</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>)</pre></body></html></div>
<p><img src="spsurv_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
</div>
<div id="remarks" class="section level2">
<h2 class="hasAnchor">
<a href="#remarks" class="anchor"></a>Remarks</h2>
<p>The content of this vignette introduces the <code>spsurv</code> package. Here, the analysis was dedicated to illustrating, in practice, the commands implemented in the proposed package spsurv. We still have work to do to improve and update this tool, however, the present version is ready for the main statistical study in the field of survival analysis. The routines presented in this dissertation are unprecedented. Many efforts with regard to the instruction the routines documentation were carried out concurrently with the spsurv package implementation. This document is part of the content submitted to <a href="https://cran.r-project.org/">CRAN</a>. The package is also in public use and is available at the github development platform, the link is: <a href="https://github.com/rvpanaro/spsurv" class="uri">https://github.com/rvpanaro/spsurv</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Renato Panaro, Fábio Demarqui, Vinícius Mayrink.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'efd1fff66c6333fc3b69114572cc8e90',
    indexName: 'spsurv',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
